generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ShareMode {
  None
  ReadOnly
  ReadWrite
}

model Page {
  id        String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  createdBy String
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  name      String
  icon      String
  userPages UserPage[]
  shareMode ShareMode  @default(None)

  @@map(name: "pages")
}

model UserPage {
  id       String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  pageId   String  @db.Uuid
  page     Page    @relation(fields: [pageId], references: [id], onDelete: Cascade)
  uid      String
  rank     String
  pinRank  String?

  @@unique([rank, uid])
  @@map(name: "user_pages")
}

// TODO once migrations settle down

// make sure pinRank + uid is unique when pinRank is not null
// CREATE UNIQUE INDEX "user_pages_pinrank_uid_unique" 
// ON "user_pages" ("pinRank", "uid") 
// WHERE "pinRank" IS NOT NULL;

// add 'C' Collation to rank and pinRank fields for proper lexorank sorting
// ALTER TABLE "user_pages" ALTER COLUMN "rank" TYPE VARCHAR COLLATE "C";
// ALTER TABLE "user_pages" ALTER COLUMN "pinRank" TYPE VARCHAR COLLATE "C";
